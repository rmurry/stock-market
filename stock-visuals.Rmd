---
title: "US Economic Data"
output:
  flexdashboard::flex_dashboard:
    vertical_layout: fill
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE, 
                      fig.align = "center",
                      dpi = 144)
remove(list = ls(all.names = TRUE))
detachAllPackages <- function() {
  basic.packages.blank <-  c("stats","graphics","grDevices","utils","datasets","methods","base")
  basic.packages <- paste("package:", basic.packages.blank, sep = "")
  package.list <- search()[ifelse(unlist(gregexpr("package:", search())) == 1,TRUE,FALSE)]
  package.list <- setdiff(package.list, basic.packages)
  if (length(package.list) > 0)  for (package in package.list) {
    detach(package, character.only = TRUE)}}
detachAllPackages()
if (!require(pacman)) {
  install.packages("pacman")
  require(pacman)
}

p_load(flexdashboard,readxl,tidyverse,highcharter,readr,timetk,quantmod)
```

```{r,  Function to Load Stock Market Data & LM}
SymbolsGraph <- function(symb,startDate) {
  temp <- getSymbols(symb,auto.assign = F,from = startDate)
  
  temp <- data.frame(temp,Date = index(temp)) %>%
    select(Date,"Close" = contains('Close'))
  lm <- lm(Close ~ Date,temp)
  results <- summary(lm)
  temp <- temp %>%
    mutate(fitted = round(lm$fitted.values,2),
           Close = round(Close,2))
  
  tempXTS <- xts(temp[,-1],order.by = temp$Date)
  
  highchart(type = "stock") %>%
    hc_add_series(tempXTS$Close,type = 'line') %>%
    hc_add_series(tempXTS$fitted,type = 'line') %>%
    hc_title(text = paste(symb,'Linear Regression',sep = ' ')) %>%
    hc_tooltip(pointFormat = 'Close: {point.Close}<br>Fitted Value: {point.fitted}')
}
```

# Stock Market Data and Trends

```{r}
SymbolsGraph('^GSPC','2009-01-20')
```
